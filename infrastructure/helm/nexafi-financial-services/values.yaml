# Default values for nexafi-financial-services
# This is a YAML-formatted file with comprehensive configuration for financial services

# Global configuration
global:
  imageRegistry: ""
  imagePullSecrets: []
  storageClass: ""
  
# Application configuration
app:
  name: financial-services
  version: "1.0.0"
  environment: production
  
# Image configuration
image:
  registry: nexafi
  repository: financial-services
  tag: "1.0.0"
  pullPolicy: IfNotPresent
  pullSecrets: []

# Deployment configuration
replicaCount: 3

# Update strategy
strategy:
  type: RollingUpdate
  rollingUpdate:
    maxUnavailable: 1
    maxSurge: 1

# Container configuration
container:
  port: 8080
  name: financial-services
  
# Security context
securityContext:
  runAsNonRoot: true
  runAsUser: 1001
  runAsGroup: 1001
  fsGroup: 1001
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: true
  capabilities:
    drop:
      - ALL

# Pod security context
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1001
  runAsGroup: 1001
  fsGroup: 1001
  seccompProfile:
    type: RuntimeDefault

# Service configuration
service:
  type: ClusterIP
  port: 80
  targetPort: 8080
  annotations:
    service.beta.kubernetes.io/aws-load-balancer-type: "nlb"
    service.beta.kubernetes.io/aws-load-balancer-backend-protocol: "tcp"

# Ingress configuration
ingress:
  enabled: true
  className: "nginx"
  annotations:
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
    nginx.ingress.kubernetes.io/backend-protocol: "HTTP"
    nginx.ingress.kubernetes.io/rate-limit: "100"
    nginx.ingress.kubernetes.io/rate-limit-window: "1m"
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
  hosts:
    - host: api.nexafi.com
      paths:
        - path: /financial
          pathType: Prefix
  tls:
    - secretName: nexafi-api-tls
      hosts:
        - api.nexafi.com

# Resource configuration
resources:
  limits:
    cpu: 1000m
    memory: 2Gi
    ephemeral-storage: 1Gi
  requests:
    cpu: 500m
    memory: 1Gi
    ephemeral-storage: 512Mi

# Horizontal Pod Autoscaler
autoscaling:
  enabled: true
  minReplicas: 3
  maxReplicas: 20
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80
  behavior:
    scaleDown:
      stabilizationWindowSeconds: 300
      policies:
      - type: Percent
        value: 10
        periodSeconds: 60
    scaleUp:
      stabilizationWindowSeconds: 60
      policies:
      - type: Percent
        value: 50
        periodSeconds: 60

# Pod Disruption Budget
podDisruptionBudget:
  enabled: true
  minAvailable: 2

# Node selection
nodeSelector:
  tier: financial

# Tolerations for financial services nodes
tolerations:
  - key: "financial-services"
    operator: "Equal"
    value: "true"
    effect: "NoSchedule"

# Affinity rules
affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
    - weight: 100
      podAffinityTerm:
        labelSelector:
          matchExpressions:
          - key: app.kubernetes.io/name
            operator: In
            values:
            - financial-services
        topologyKey: kubernetes.io/hostname

# Liveness probe
livenessProbe:
  httpGet:
    path: /health
    port: 8080
  initialDelaySeconds: 60
  periodSeconds: 30
  timeoutSeconds: 10
  failureThreshold: 3
  successThreshold: 1

# Readiness probe
readinessProbe:
  httpGet:
    path: /ready
    port: 8080
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3
  successThreshold: 1

# Startup probe
startupProbe:
  httpGet:
    path: /health
    port: 8080
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 30
  successThreshold: 1

# Environment variables
env:
  - name: NODE_ENV
    value: "production"
  - name: PORT
    value: "8080"
  - name: LOG_LEVEL
    value: "info"
  - name: METRICS_ENABLED
    value: "true"
  - name: HEALTH_CHECK_ENABLED
    value: "true"

# Environment variables from secrets
envFromSecrets:
  - name: DATABASE_URL
    secretName: financial-db-secret
    secretKey: url
  - name: JWT_SECRET
    secretName: jwt-secret
    secretKey: secret
  - name: ENCRYPTION_KEY
    secretName: encryption-secret
    secretKey: key

# Environment variables from config maps
envFromConfigMaps:
  - name: REDIS_HOST
    configMapName: infrastructure-config
    configMapKey: redis_host
  - name: RABBITMQ_HOST
    configMapName: infrastructure-config
    configMapKey: rabbitmq_host

# Volume mounts
volumeMounts:
  - name: tmp
    mountPath: /tmp
  - name: logs
    mountPath: /app/logs
  - name: config
    mountPath: /app/config
    readOnly: true

# Volumes
volumes:
  - name: tmp
    emptyDir: {}
  - name: logs
    emptyDir: {}
  - name: config
    configMap:
      name: financial-services-config

# Service Account
serviceAccount:
  create: true
  annotations:
    eks.amazonaws.com/role-arn: "arn:aws:iam::ACCOUNT_ID:role/nexafi-financial-services-role"
  name: "financial-services-sa"

# Pod annotations
podAnnotations:
  prometheus.io/scrape: "true"
  prometheus.io/port: "8080"
  prometheus.io/path: "/metrics"
  vault.hashicorp.com/agent-inject: "true"
  vault.hashicorp.com/role: "financial-services"

# Pod labels
podLabels:
  app.kubernetes.io/component: "financial-services"
  app.kubernetes.io/part-of: "nexafi"
  tier: "financial"
  compliance: "pci-dss"

# Network Policy
networkPolicy:
  enabled: true
  ingress:
    - from:
      - namespaceSelector:
          matchLabels:
            name: api-gateway
      ports:
      - protocol: TCP
        port: 8080
    - from:
      - namespaceSelector:
          matchLabels:
            name: monitoring
      ports:
      - protocol: TCP
        port: 8080
  egress:
    - to:
      - namespaceSelector:
          matchLabels:
            name: database
      ports:
      - protocol: TCP
        port: 5432
    - to:
      - namespaceSelector:
          matchLabels:
            name: infrastructure-components
      ports:
      - protocol: TCP
        port: 6379
      - protocol: TCP
        port: 5672

# Monitoring configuration
monitoring:
  enabled: true
  serviceMonitor:
    enabled: true
    interval: 30s
    path: /metrics
    labels:
      app: financial-services
      tier: financial

# Backup configuration
backup:
  enabled: true
  schedule: "0 2 * * *"
  retention: "30d"

# Database configuration
postgresql:
  enabled: false  # Use external managed database
  
# Redis configuration  
redis:
  enabled: false  # Use external managed Redis

# Configuration for external dependencies
externalDatabase:
  host: "financial-db.database.svc.cluster.local"
  port: 5432
  database: "financial"
  existingSecret: "financial-db-secret"
  existingSecretPasswordKey: "password"
  existingSecretUsernameKey: "username"

externalRedis:
  host: "redis.infrastructure-components.svc.cluster.local"
  port: 6379
  existingSecret: "redis-secret"
  existingSecretPasswordKey: "password"

# Compliance configuration
compliance:
  pciDss:
    enabled: true
    dataClassification: "restricted"
    encryptionRequired: true
  soc2:
    enabled: true
    auditLogging: true
  gdpr:
    enabled: true
    dataRetention: "7y"
    rightToErasure: true

# Security configuration
security:
  podSecurityPolicy:
    enabled: true
  networkPolicy:
    enabled: true
  rbac:
    enabled: true
  vault:
    enabled: true
    role: "financial-services"
    
# Feature flags
features:
  paymentProcessing: true
  creditScoring: true
  fraudDetection: true
  complianceReporting: true
  auditTrail: true

